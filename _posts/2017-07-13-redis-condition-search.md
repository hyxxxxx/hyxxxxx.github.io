---
layout: post
title: "Redis条件查询"
date: 2017-07-13
excerpt: "有时候我们会为了减轻关系数据库的压力，甚至是为了提升性能，把关系型数据库中某张经常被查询却很少修改的表..."
tags: 
- Original
- Redis
- Database
comments: true
---

> 版权声明：本文为博主原创文章，未经博主允许不得转载。

### 为什么要条件查询

有时候我们会为了减轻关系数据库的压力，甚至是为了提升性能，把关系型数据库中某张**经常被查询却很少修改的表**缓存到REDIS这种NOSQL数据库中，比如用户表（USER）。

只是以一个HASH的形式丢进REDIS后会发现，不能对这些用户进行条件查询，如果遇到有筛选的业务时，只有哦豁。。。

当然REDIS肯定是不会提供条件查询的啦，但是我们可以通过设计来实现

------------

### 设计思路
1. 现有USER表需要缓存到REDIS中，当然不一定是USER的所有字段，我们也可以多增加几个关联表的字段作为一个ENTITY
2. 把用户ID作为KEY，对象做为VALUE存入HASH
3. 比方说现需要查询年龄等于25岁的用户
4. 则在插入HASH的同时把满足条件的用户ID存入一个SET中，SET的KEY就以该条件命名，如：`SYS_USER_SEL_AGE_25`
5. 查询时先查SET的ID，再通过ID集合去查询HASH


        备注：如果有**多条件**，则存入多个SET
        查询时将SET求交集或者并集，如REDIS的`SINTER`方法就是取交集
        再去HASH里得到结果
